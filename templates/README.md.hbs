{{#if isAzure}}
# Wingbot on Azure

There are two ways of running Wingbot on Microsoft Azure:

1. Azure Functions - serverless mode
2. Azure Web Apps - Express mode

## Prerequisites

Before you can deploy your bot for the first time, you must fulfill these requirements:

1. have active Azure account: https://azure.microsoft.com

2. install [Azure CLI 2.0](https://docs.microsoft.com/en-us/cli/azure/install-azure-cli?view=azure-cli-latest) - it's cross-platform

3. sign into the CLI and choose correct subscription

   ```
   az login
   az account set --subscription "<subscription name or id>"
   ```

4. register an app for your bot using the [App Registration portal](https://apps.dev.microsoft.com/) - get Application ID and Password

## First deployment

To deploy the application for the first time, use the `deploy` script in `bin` folder. It's automatically generated by the Wingbot CLI, but you can change any values to better match your environment.

Windows:

```
cd bin
deploy.cmd
```

Bash:

```
TBD :(
```

## Deployment steps

Deployment script goes through all of those steps, but you can run them individually as needed.

1. npm-pack-zip generates ZIP package which can be deployed to Azure:

```
npm run pack
```

2. Azure CLI creates Azure Resource Group:

```
az group create -n "group" -l "northeurope"
```

3. Azure CLI deploys ARM template to this Resource Group

```
az group deployment create -g "group" --template-file ..\deployment\template.json --parameters ..\deployment\parameters.json
```

If you change the template/parameters and initiate deployment again, Azure Resource Manager will deploy only those changes.

4. Azure CLI deploys ZIP package to Azure Function / Azure Web App (depending on the type of infrastructure selected).

```
az functionapp deployment source config-zip -g "group" -n "myapp" --src "..\myapp.zip"
--OR--
az webapp deployment source config-zip -g "group" -n "myapp" --src "..\myapp.zip"
```

## Infrastructure

Following resources are created in Azure:

* Application Insights
* Storage Account
* Cosmos DB, with default throughtput **1000 RU/s**
  * if *Database name* was provided when generating project
* Function App, **Consumption** App Service Plan 
  * if Wingbot type is *Azure Serverless*
* Web App, **Free** App Service Plan 
  * if Wingbot type is *Azure Express*
* Bot Service
  * if selected when generating project
  * with Facebook, Webchat and DirectLine channels enabled
  * requires Application ID from Microsoft App Registration Portal
{{/if}}